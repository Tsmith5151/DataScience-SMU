---
title: "Case Study 1"
author: "Trace Smith"
date: "October 20, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Introduction:

The objective of this work is to take two separates data files, clean up the data, merge, and then perform some statistical analysis on the final merged data set. The raw [`Gross Domestic Product Ranking Table`](http://data.worldbank.org/data-catalog/GDP-ranking-table) data set consists of 327 rows and 10 columns while the [`Education Statistics`](http://data.worldbank.org/data-catalog/ed-stats) contains 31 different features with 234 rows. Note, the dimensions of the raw data includes rows with NA's and missing values (i.e. blank observations). Both data sets were downloaded from the world bank website and then read into separate data frames. From here, several steps were taken to tidy the data before merging the two data frames in the `merge.r` file. The source code for tidying the data can be found in the `merge.r` and the process will be discussed in more details in a later section.

After preprocessing the data, the ultimate goal is to be able to extract information to answer specific questions. Therefore, the aim of `analysis.r` is to address the following inquiries:
- Merge the data based on the country shortcode. How many of the IDs match?
- Sort the data frame in ascending order by GDP (so United States is last). What is the 13th
country in the resulting data frame?
- What are the average GDP rankings for the "High income: OECD" and "High income:
nonOECD" groups?
- Plot the GDP for all of the countries. Use ggplot2 to color your plot by Income Group.
- Cut the GDP ranking into 5 separate quantile groups. Make a table versus Income.Group.
- How many countries are Lower middle income but among the 38 nations with highest
GDP?


### R Packages:
```{r}
library(plyr)
library(ggplot2)
library(downloader)
```

### Set Working Directory:

**Note:** The working directory should be set to the root node: "Case Study 1"

```{r}
dir <- "/Users/tracesmith/Desktop/SMU/Github/DoingDataScience/Case Study 1"
setwd(dir)
```

### Downloading the Dataset:

There are two options when downloading the either of the data sets. First option is shown below where we identify the URL link to the data source and download the file from the website. Furthermore, `destfile` refers to directory the file will be stored in along with the name of the file (i.e. GDP.csv). The important piece to remember here is setting the working directory to the root directory: `Case Study 1`.


```{r}
#Download Data GDP Ranking:
url<-"https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FEDSTATS_Country.csv"
download(url,destfile="Data/FEDSTATS_Country.raw.csv") #download file and save it to Data directory
```


```{r}
#Download Educational Data
url<-"https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FGDP.csv"
download(url,destfile="Data/FGDP.raw.csv")
```

The second option is to download the file directly from [`The World Bank`](http://www.worldbank.org/) website directly and then move to from the download fold to the Data directory.

### Tyding the Dataset:

*Note:* The code to answer the questions later in this report is based on removing all NA's in the Ranking column for the merge.data.final data frame. Before removing cells containing NA for the Ranking column, the code below counts the number of NA cells for each column:


### Question 1:
**Merge the data based on the country shortcode. How many of the IDs match?**

```{r include=FALSE}
source("Analysis/tidy.r")
source("Analysis/merge.r")
source("Analysis/analysis.r")
```

```{r}
#Question:1 Number of Matches
print(paste0("Total Number of ID Matches: ",
             length(intersect(fedstats$CountryCode,gdp$CountryCode))))
```

### Question 2:
**Sort the data frame in ascending order by GDP (so United States is last). What is the 13th country in the resulting data frame?**

```{r}
sort.gdp <-merge.data.final[order(merge.data.final$GDP,decreasing=FALSE,na.last = TRUE),][12:13,]
sort.gdp[,c("Long.Name","Ranking","GDP")]
```

### Question 3:
**What are the average GDP rankings for the "High income: OECD" and "High income: nonOECD" groups?**

```{r}
merge.data.agg <- ddply(merge.data.final, .(Income.Group), summarize,  Rank=mean(Rank))
#merge.data.agg <-merge.data.agg[!(is.na(merge.data.agg$Rank) | merge.data.agg$Rank==""), ]
head(merge.data.agg,5)
```

### Question 4:
**Plot the GDP for all of the countries. Use ggplot2 to color your plot by Income Group.**

```{r}
p<-ggplot(merge.data.final)+ geom_point(aes(y=GDP,x=Income.Group,colour=Income.Group)) +scale_y_log10()
p+labs(title="GDP vs Income Group",
       x="Income Groups",y="Log: GDP-millions",colour="Income Group") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
```

### Question 5:
**Cut the GDP ranking into 5 separate quantile groups. Make a table versus Income.Group. How many countries are Lower middle income but among the 38 nations with highest GDP?**

```{r}
merge.data.final$Ranking <- as.numeric(as.character(merge.data.final$Ranking))
merge.data.final$Group <- cut(merge.data.final$Ranking,breaks=5)
quant.table<-table(merge.data.final$Income.Group, merge.data.final$Group)
quant.table
```


### Conclusion